-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.broken_link_scans (
  id integer NOT NULL DEFAULT nextval('broken_link_scans_id_seq'::regclass),
  website_id integer NOT NULL,
  scan_started_at timestamp without time zone NOT NULL DEFAULT now(),
  scan_completed_at timestamp without time zone,
  scan_status character varying DEFAULT 'pending'::character varying,
  total_links_checked integer DEFAULT 0,
  broken_links_found integer DEFAULT 0,
  pages_scanned integer DEFAULT 0,
  scan_type character varying DEFAULT 'full'::character varying,
  scan_settings jsonb,
  error_message text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT broken_link_scans_pkey PRIMARY KEY (id),
  CONSTRAINT broken_link_scans_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id)
);
CREATE TABLE public.broken_links (
  id integer NOT NULL DEFAULT nextval('broken_links_id_seq'::regclass),
  website_id integer NOT NULL,
  url character varying NOT NULL,
  source_url character varying NOT NULL,
  link_text text,
  link_type character varying NOT NULL DEFAULT 'internal'::character varying,
  status_code integer,
  error_message text,
  scan_timestamp timestamp without time zone NOT NULL DEFAULT now(),
  last_checked timestamp without time zone DEFAULT now(),
  is_fixed boolean DEFAULT false,
  fix_suggestion text,
  priority character varying DEFAULT 'medium'::character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT broken_links_pkey PRIMARY KEY (id),
  CONSTRAINT broken_links_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id)
);
CREATE TABLE public.client_report_sections (
  id integer NOT NULL DEFAULT nextval('client_report_sections_id_seq'::regclass),
  report_id integer NOT NULL,
  section_type character varying NOT NULL,
  title character varying NOT NULL,
  content text NOT NULL,
  order integer DEFAULT 0,
  is_visible boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT client_report_sections_pkey PRIMARY KEY (id),
  CONSTRAINT client_report_sections_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.client_reports(id)
);
CREATE TABLE public.client_report_templates (
  id integer NOT NULL DEFAULT nextval('client_report_templates_id_seq'::regclass),
  user_id integer NOT NULL,
  name character varying NOT NULL,
  description text,
  is_default boolean DEFAULT false,
  language character varying DEFAULT 'en'::character varying,
  date_format character varying DEFAULT 'YYYY-MM-DD'::character varying,
  logo_url character varying,
  company_name character varying,
  intro_message text,
  outro_message text,
  include_optimization boolean DEFAULT true,
  include_custom_work boolean DEFAULT true,
  include_updates boolean DEFAULT true,
  include_backups boolean DEFAULT true,
  include_analytics boolean DEFAULT false,
  include_security boolean DEFAULT true,
  include_performance boolean DEFAULT true,
  include_uptime_monitor boolean DEFAULT false,
  include_seo_ranking boolean DEFAULT true,
  include_woocommerce boolean DEFAULT false,
  primary_color character varying DEFAULT '#0066cc'::character varying,
  secondary_color character varying DEFAULT '#f8f9fa'::character varying,
  font_family character varying DEFAULT 'Arial, sans-serif'::character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT client_report_templates_pkey PRIMARY KEY (id),
  CONSTRAINT client_report_templates_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.client_reports (
  id integer NOT NULL DEFAULT nextval('client_reports_id_seq'::regclass),
  user_id integer NOT NULL,
  template_id integer,
  title character varying NOT NULL,
  client_id integer,
  website_ids jsonb NOT NULL,
  date_from timestamp without time zone NOT NULL,
  date_to timestamp without time zone NOT NULL,
  status character varying DEFAULT 'generating'::character varying,
  error_message text,
  report_data jsonb,
  pdf_path character varying,
  share_token character varying UNIQUE,
  is_publicly_shared boolean DEFAULT false,
  is_scheduled boolean DEFAULT false,
  schedule_frequency character varying,
  next_scheduled_date timestamp without time zone,
  email_recipients jsonb,
  email_sent boolean DEFAULT false,
  email_sent_at timestamp without time zone,
  generated_at timestamp without time zone,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT client_reports_pkey PRIMARY KEY (id),
  CONSTRAINT client_reports_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT client_reports_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.client_report_templates(id),
  CONSTRAINT client_reports_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.clients (
  id integer NOT NULL DEFAULT nextval('clients_id_seq'::regclass),
  name character varying NOT NULL,
  email character varying NOT NULL,
  phone character varying,
  company character varying,
  status character varying NOT NULL DEFAULT 'active'::character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  user_id integer NOT NULL,
  CONSTRAINT clients_pkey PRIMARY KEY (id),
  CONSTRAINT clients_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.performance_scans (
  id integer NOT NULL DEFAULT nextval('performance_scans_id_seq'::regclass),
  website_id integer NOT NULL,
  scan_timestamp timestamp without time zone NOT NULL DEFAULT now(),
  performance_score integer,
  load_time integer,
  page_size integer,
  requests_count integer,
  first_contentful_paint integer,
  largest_contentful_paint integer,
  cumulative_layout_shift real,
  recommendations jsonb,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT performance_scans_pkey PRIMARY KEY (id),
  CONSTRAINT performance_scans_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id)
);
CREATE TABLE public.seo_keywords (
  id integer NOT NULL DEFAULT nextval('seo_keywords_id_seq'::regclass),
  website_id integer NOT NULL,
  report_id integer,
  keyword character varying NOT NULL,
  search_volume integer DEFAULT 0,
  difficulty integer DEFAULT 0,
  current_position integer,
  previous_position integer,
  position_change integer DEFAULT 0,
  url character varying,
  search_engine character varying DEFAULT 'google'::character varying,
  location character varying DEFAULT 'global'::character varying,
  device character varying DEFAULT 'desktop'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT seo_keywords_pkey PRIMARY KEY (id),
  CONSTRAINT seo_keywords_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id),
  CONSTRAINT seo_keywords_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.seo_reports(id)
);
CREATE TABLE public.seo_metrics (
  id integer NOT NULL DEFAULT nextval('seo_metrics_id_seq'::regclass),
  website_id integer NOT NULL,
  report_id integer,
  total_pages integer DEFAULT 0,
  indexed_pages integer DEFAULT 0,
  organic_keywords integer DEFAULT 0,
  backlinks integer DEFAULT 0,
  domain_authority integer DEFAULT 0,
  pagespeed_score integer DEFAULT 0,
  mobile_score integer DEFAULT 0,
  core_web_vitals_score integer DEFAULT 0,
  security_score integer DEFAULT 0,
  ssl_status boolean DEFAULT false,
  robots_txt_status boolean DEFAULT false,
  sitemap_status boolean DEFAULT false,
  h1_count integer DEFAULT 0,
  missing_meta_descriptions integer DEFAULT 0,
  missing_alt_tags integer DEFAULT 0,
  duplicate_titles integer DEFAULT 0,
  internal_links integer DEFAULT 0,
  external_links integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT seo_metrics_pkey PRIMARY KEY (id),
  CONSTRAINT seo_metrics_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id),
  CONSTRAINT seo_metrics_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.seo_reports(id)
);
CREATE TABLE public.seo_page_analysis (
  id integer NOT NULL DEFAULT nextval('seo_page_analysis_id_seq'::regclass),
  website_id integer NOT NULL,
  report_id integer,
  url character varying NOT NULL,
  title text,
  meta_description text,
  h1_tag text,
  word_count integer DEFAULT 0,
  internal_links_count integer DEFAULT 0,
  external_links_count integer DEFAULT 0,
  image_count integer DEFAULT 0,
  missing_alt_tags integer DEFAULT 0,
  load_time integer,
  mobile_score integer DEFAULT 0,
  pagespeed_score integer DEFAULT 0,
  issues jsonb NOT NULL DEFAULT '[]'::jsonb,
  recommendations jsonb NOT NULL DEFAULT '[]'::jsonb,
  last_analyzed timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT seo_page_analysis_pkey PRIMARY KEY (id),
  CONSTRAINT seo_page_analysis_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id),
  CONSTRAINT seo_page_analysis_report_id_fkey FOREIGN KEY (report_id) REFERENCES public.seo_reports(id)
);
CREATE TABLE public.seo_rankings (
  id integer NOT NULL DEFAULT nextval('seo_rankings_id_seq'::regclass),
  website_id integer NOT NULL,
  keyword character varying NOT NULL,
  current_position integer,
  previous_position integer,
  position_change integer DEFAULT 0,
  search_volume integer,
  competitiveness character varying DEFAULT 'medium'::character varying,
  difficulty integer,
  target_url character varying,
  search_engine character varying DEFAULT 'google'::character varying,
  country character varying DEFAULT 'US'::character varying,
  device character varying DEFAULT 'desktop'::character varying,
  last_checked timestamp without time zone DEFAULT now(),
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT seo_rankings_pkey PRIMARY KEY (id),
  CONSTRAINT seo_rankings_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id)
);
CREATE TABLE public.seo_reports (
  id integer NOT NULL DEFAULT nextval('seo_reports_id_seq'::regclass),
  website_id integer NOT NULL,
  overall_score integer NOT NULL,
  technical_score integer NOT NULL,
  content_score integer NOT NULL,
  backlinks_score integer NOT NULL,
  user_experience_score integer NOT NULL,
  on_page_seo_score integer NOT NULL,
  report_data jsonb NOT NULL,
  recommendations jsonb NOT NULL,
  critical_issues integer DEFAULT 0,
  warnings integer DEFAULT 0,
  notices integer DEFAULT 0,
  report_type character varying DEFAULT 'automated'::character varying,
  generated_at timestamp without time zone DEFAULT now(),
  created_at timestamp without time zone DEFAULT now(),
  scan_duration integer,
  scan_status character varying DEFAULT 'completed'::character varying,
  error_message text,
  CONSTRAINT seo_reports_pkey PRIMARY KEY (id),
  CONSTRAINT seo_reports_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id)
);
CREATE TABLE public.sessions (
  sid character varying NOT NULL,
  sess jsonb NOT NULL,
  expire timestamp without time zone NOT NULL,
  CONSTRAINT sessions_pkey PRIMARY KEY (sid)
);
CREATE TABLE public.subscription_plans (
  id integer NOT NULL DEFAULT nextval('subscription_plans_id_seq'::regclass),
  name character varying NOT NULL UNIQUE,
  display_name character varying NOT NULL,
  description text,
  monthly_price integer NOT NULL,
  yearly_price integer NOT NULL,
  features jsonb NOT NULL,
  is_active boolean DEFAULT true,
  stripe_price_id_monthly character varying,
  stripe_price_id_yearly character varying,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT subscription_plans_pkey PRIMARY KEY (id)
);
CREATE TABLE public.tasks (
  id integer NOT NULL DEFAULT nextval('tasks_id_seq'::regclass),
  title character varying NOT NULL,
  description text,
  type character varying NOT NULL,
  status character varying NOT NULL DEFAULT 'pending'::character varying,
  priority character varying NOT NULL DEFAULT 'medium'::character varying,
  due_date timestamp without time zone,
  completed_at timestamp without time zone,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  website_id integer NOT NULL,
  client_id integer NOT NULL,
  CONSTRAINT tasks_pkey PRIMARY KEY (id),
  CONSTRAINT tasks_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id),
  CONSTRAINT tasks_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);
CREATE TABLE public.update_logs (
  id integer NOT NULL DEFAULT nextval('update_logs_id_seq'::regclass),
  website_id integer NOT NULL,
  user_id integer NOT NULL,
  update_type character varying NOT NULL CHECK (update_type::text = ANY (ARRAY['plugin'::character varying, 'theme'::character varying, 'wordpress'::character varying]::text[])),
  item_name character varying NOT NULL,
  item_slug character varying,
  from_version character varying,
  to_version character varying,
  update_status character varying NOT NULL DEFAULT 'pending'::character varying CHECK (update_status::text = ANY (ARRAY['pending'::character varying, 'success'::character varying, 'failed'::character varying]::text[])),
  error_message text,
  update_data jsonb,
  duration integer,
  automated_update boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT update_logs_pkey PRIMARY KEY (id),
  CONSTRAINT update_logs_website_id_fkey FOREIGN KEY (website_id) REFERENCES public.websites(id),
  CONSTRAINT update_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id integer NOT NULL DEFAULT nextval('users_id_seq'::regclass),
  email character varying NOT NULL UNIQUE,
  password character varying NOT NULL,
  first_name character varying,
  last_name character varying,
  phone character varying,
  company character varying,
  bio text,
  website character varying,
  location character varying,
  avatar character varying,
  profile_image_url character varying,
  email_notifications boolean DEFAULT true,
  push_notifications boolean DEFAULT true,
  sms_notifications boolean DEFAULT false,
  security_alerts boolean DEFAULT true,
  maintenance_updates boolean DEFAULT true,
  weekly_reports boolean DEFAULT true,
  stripe_customer_id character varying,
  stripe_subscription_id character varying,
  subscription_plan character varying DEFAULT 'free'::character varying,
  subscription_status character varying DEFAULT 'inactive'::character varying,
  subscription_ends_at timestamp without time zone,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.websites (
  id integer NOT NULL DEFAULT nextval('websites_id_seq'::regclass),
  name character varying NOT NULL,
  url character varying NOT NULL,
  wp_admin_username character varying,
  wp_admin_password character varying,
  wrm_api_key character varying,
  wp_version character varying,
  last_backup timestamp without time zone,
  last_update timestamp without time zone,
  last_sync timestamp without time zone,
  health_status character varying NOT NULL DEFAULT 'good'::character varying,
  uptime character varying DEFAULT '100%'::character varying,
  connection_status character varying DEFAULT 'disconnected'::character varying,
  wp_data text,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  client_id integer NOT NULL,
  screenshot_url character varying,
  screenshot_taken_at timestamp without time zone,
  CONSTRAINT websites_pkey PRIMARY KEY (id),
  CONSTRAINT websites_client_id_fkey FOREIGN KEY (client_id) REFERENCES public.clients(id)
);